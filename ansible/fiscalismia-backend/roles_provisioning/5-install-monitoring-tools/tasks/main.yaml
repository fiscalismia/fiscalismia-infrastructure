- name: Install essential monitoring package suite
  ansible.builtin.dnf:
    name:
      - htop           # Enhanced process monitor for CPU/Memory/Load
      - iotop          # Monitor disk I/O by process (important for FastAPI file operations)
      - nethogs        # Monitor network bandwidth by process (API traffic monitoring)
      - sysstat        # System performance tools (sar, iostat, mpstat)
    state: latest
    update_cache: true

# Usage Instructions:
#
# 1. HTOP - Interactive process viewer
#    Commands: htop
#    - Press F5 to show process tree
#    - Press F6 to sort by different columns (CPU%, MEM%, TIME)
#    - Press F9 to kill processes
#    - Look for python/uvicorn processes consuming high CPU/memory
#
# 2. IOTOP - I/O monitoring by process
#    Commands:
#    - iotop -a        # Show accumulated I/O instead of bandwidth
#    - iotop -o        # Only show processes doing I/O
#    - iotop -p PID    # Monitor specific process (your FastAPI container)
#    - Monitor for high disk read/write from your FastAPI app
#
# 3. NETHOGS - Network bandwidth monitoring by process
#    Commands:
#    - nethogs         # Monitor all interfaces
#    - nethogs eth0    # Monitor specific interface
#    - Press 's' to sort by sent traffic
#    - Press 'r' to sort by received traffic
#    - Identify which processes are using most network bandwidth
#
# 4. SYSSTAT - System performance statistics
#    Commands:
#    - iostat -x 1 5    # Extended disk stats every 1 sec, 5 times
#    - sar -u 1 10      # CPU utilization every 1 sec, 10 times
#    - sar -r 1 5       # Memory utilization every 1 sec, 5 times
#    - sar -n DEV 1 5   # Network statistics every 1 sec, 5 times
#    - mpstat 1 5       # Processor statistics every 1 sec, 5 times
#
# For Docker container monitoring, use native Docker commands:
#    - docker stats                    # All containers live view
#    - docker stats CONTAINER_NAME    # Specific container
#    - docker stats --no-stream       # One-time snapshot
#
# Typical FastAPI Monitoring Workflow:
# 1. Start with 'htop' to see overall system load
# 2. Use 'docker stats' to check container resource usage
# 3. If high I/O, run 'iotop -a' to identify disk bottlenecks
# 4. If high network usage, run 'nethogs' to see traffic by process
# 5. Use 'sar' commands for historical performance analysis
# 6. Use 'ncdu' to analyze disk space usage